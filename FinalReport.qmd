---
title: "Stat 331 Project Report"
author: "Hailey Hossain, Zoey Miles, Ashley Navos, Vinithra Seshan"
format: 
  html:
    embed-resources: true
    code-tools: true
    toc: true
    code-fold: true
editor: source
execute: 
  error: true
  echo: true
  message: false
  warning: false
---

```{r setup}
library(tidyverse)
library(readr)
library(knitr)
library(gganimate)
library(broom)
library(kableExtra)
library(gifski)
```

## Introduction

Income and life expectancy have historically been shown to be correlated. At age 40, men in the top 1% income bracket are expected to live 14.6 years longer than those in the bottom 1%, and women can expect to live 10.1 years longer (Chetty et. al). We decided to explore the relationship between the income share of the middle 20% of individuals and life expectancy at birth to see how this correlation has changed throughout time and across countries.

We hypothesize a positive relationship between Income Share of the Poorest 20% and Life Expectancy at Birth at the country level. As the share of total national income received by the middle 20% increases, life expectancy is expected to rise. We expect this relationship as income inequality results in unequal access to public goods, such as basic necessities. Additionally, economists frequently conclude that a strong missle class contributes heavily to overall quality of life and, in turn, life expectancy. We expect the relationship to be moderate as there are many factors outside of income that influence life expectancy, such as access to healthcare, education, and personal choices. 

The two variables that we are using are the Income Share of the Middle 20% and Life Expectancy at Birth. The Income Share of the Middle 20% is from the World Bank Group and measures the proportion of a country's total income received by the middle 20% (third quintile). We have the proportions for each country and year, spanning 60 years. Life Expectancy at Birth is the average number of years a newborn child would live if current mortality patterns were to stay the same. The values were calculated using two main sources - the Human Mortality Database and the United Nations Population divisions World Population Prospects. We have estimates of Life Expectancy at Birth for each country and year, stretching over 200 years.

## Data Cleaning

The analysis may be impacted by how the data is sorted.  The income share data set has income share by country and year, and we may see different results depending on the time frame or country we choose.  The life expectancy at birth data set also has the option to sort by country and region, but has yearly data for life expectancy worldwide as well. The life expectancy dataset also has a “Notes and Uncertainty” section that writes about confounding factors affecting life expectancy, including pandemics, famines, war, and genocide. We did our best to account for these factors when cleaning the data.

When cleaning the data, we made the dataset for Life Expectancy smaller since it spanned 200 years. We chose the years 1950 to 2050 as the dataset for Income Share of the middle 20% only spans from 1963 to 2023. For the income dataset, the frequency of data varies from country to country, as some countries like the USA have values for every year while others are inconsistent or sparse. This was accounted for when joining the two data sets, producing a set which contained only data for countries and years that reported both values. Thius resulted in a large reduction of our data pool, as many countries had little or no data on income share for some reporting decades. Due to there being no clear pattern found in which values were missing, as well as the nature of our analysis, we felt it best to remove all missing values from both data sets, keeping only data points share by both sets of data.

```{r}
lex <- read_csv("lex.csv")

lex_long <- lex |>
  select(country,"1950":"2050") |>
  pivot_longer(cols = !country, 
               names_to = "year", 
               values_to = "life_ex")

income_share_middle <- read_csv("income_share_of_middle_20percent.csv")

income_share_long <- income_share_middle |> 
  pivot_longer(cols = !country, 
               names_to = "year", 
               values_to = "income_share")

joined_data <- left_join(lex_long, 
                         income_share_long, 
                         join_by(country==country,year==year))

joined_data <- joined_data |>
  filter(!is.na(income_share)) |>
  mutate(year = as.numeric(year))
```








